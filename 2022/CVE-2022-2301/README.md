### CVE-2022-2301

### PoC Links
[Huntr.dev](https://huntr.dev/bounties/f6b9114b-671d-4948-b946-ffe5c9aeb816/)

### Docker Container Run Command
```shell
docker build -t cve-2022-2301-poc .
docker run -itd --name CVE-2022-2301-POC cve-2022-2301-poc
docker exec -it CVE-2022-2301-POC /bin/bash
```

### PoC Reproduce Command
```shell
# Preparing the initial environment
apt-get update -y
apt-get install git -y

# Configure local SSH for Github and clone the repository. (ssh-keygen)
cd /poc
git clone git@github.com:hpjansson/chafa.git

# Rollback to the vulnerable version.
cd chafa/
git reset --hard 395e9f63174734088149123de2600c2cb429b933

# Install the compilation and installation dependencies.
apt install gcc make pkg-config libgtk2.0-dev clang g++ libtool-bin build-essential llvm-dev libunwind-dev -y

# Configure, compile, and install.
export CFLAGS="-g -O0 -lpthread -fsanitize=address"
export CXXFLAGS="-g -O0 -lpthread -fsanitize=address"
export LDFLAGS="-fsanitize=address"

./autogen.sh
./configure --disable-shared
make && make install
ldconfig

# Open the poc file.
chafa /poc/poc.png
```

### Description
Observed that:
```
=================================================================
==12252==ERROR: AddressSanitizer: stack-buffer-overflow on address 0xfffff5b557c4 at pc 0xaaaade83d680 bp 0xfffff5b556c0 sp 0xfffff5b556d0
READ of size 4 at 0xfffff5b557c4 thread T0
#0 0xaaaade83d67c in load_header /poc/chafa/tools/chafa/xwd-loader.c:185
#1 0xaaaade840480 in xwd_loader_new_from_mapping /poc/chafa/tools/chafa/xwd-loader.c:250
#2 0xaaaade83ae80 in media_loader_new /poc/chafa/tools/chafa/media-loader.c:213
#3 0xaaaade8328e8 in run_generic /poc/chafa/tools/chafa/chafa.c:1632
#4 0xaaaade833610 in run /poc/chafa/tools/chafa/chafa.c:1790
#5 0xaaaade8338e4 in run_all /poc/chafa/tools/chafa/chafa.c:1847
#6 0xaaaade833dd4 in main /poc/chafa/tools/chafa/chafa.c:1891
#7 0xffffb4ef73f8  (/lib/aarch64-linux-gnu/libc.so.6+0x273f8)
#8 0xffffb4ef74c8 in __libc_start_main (/lib/aarch64-linux-gnu/libc.so.6+0x274c8)
#9 0xaaaade829c2c in _start (/usr/local/bin/chafa+0x3cc2c)

Address 0xfffff5b557c4 is located in stack of thread T0 at offset 148 in frame
#0 0xaaaade83c844 in load_header /poc/chafa/tools/chafa/xwd-loader.c:171

This frame has 1 object(s):
[48, 148) 'in' (line 173) <== Memory access at offset 148 overflows this variable
HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork
(longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow /poc/chafa/tools/chafa/xwd-loader.c:185 in load_header
Shadow bytes around the buggy address:
0x200ffeb6aaa0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ffeb6aab0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ffeb6aac0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ffeb6aad0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ffeb6aae0: 00 00 00 00 00 00 f1 f1 f1 f1 f1 f1 00 00 00 00
=>0x200ffeb6aaf0: 00 00 00 00 00 00 00 00[04]f3 f3 f3 f3 f3 00 00
0x200ffeb6ab00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ffeb6ab10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
0x200ffeb6ab20: 00 00 00 00 f1 f1 f1 f1 f1 f1 04 f2 04 f2 04 f2
0x200ffeb6ab30: 04 f2 04 f2 04 f2 00 00 00 00 00 00 00 00 00 00
0x200ffeb6ab40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 f3
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable:           00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone:       fa
Freed heap region:       fd
Stack left redzone:      f1
Stack mid redzone:       f2
Stack right redzone:     f3
Stack after return:      f5
Stack use after scope:   f8
Global redzone:          f9
Global init order:       f6
Poisoned by user:        f7
Container overflow:      fc
Array cookie:            ac
Intra object redzone:    bb
ASan internal:           fe
Left alloca redzone:     ca
Right alloca redzone:    cb
Shadow gap:              cc
==12252==ABORTING
```


